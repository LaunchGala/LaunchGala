import{d as P,e as c}from"./DrI_N8as.js";import{r as g,g as u,cS as y}from"./D0hPKPsa.js";function T(){return globalThis.$fetch}function I(){return P("openai_key",()=>"")}function $(){return y("init",()=>!1)}function _(){const t=c(),l=c(),d=c(),f=I(),h=$(),a=g(!1),r=g(""),S=u(()=>{var e,n;return((n=(e=r.value.split("```vue"))==null?void 0:e[1])==null?void 0:n.replace("```",""))??""});function w(e,n,o){return a.value=!0,$fetch("/api/init",{method:"POST",body:{prompt:e,slug:n,basedOnResultId:o},headers:{"x-openai-key":f.value}})}async function p(e,n){a.value=!0,r.value="";try{const m=(await $fetch(e,{method:"POST",body:n,responseType:"stream",headers:{"x-openai-key":f.value}})).getReader(),E=new TextDecoder("utf-8"),v=async()=>{const{done:k,value:x}=await m.read();if(k)return console.log("release locked"),a.value=!1,t.trigger(),m.releaseLock();const s=E.decode(x,{stream:!0});if(s.includes("[Error]:"))throw new Error(s.split("[Error]:")[1]);return r.value+=s,d.trigger(r.value),v()};await v()}catch(o){console.log(o),a.value=!1,o instanceof Error&&l.trigger(o.message)}}return{loading:a,content:r,contentCode:S,isNewPrompt:h,handleInit:w,handleCreate:e=>(h.value=!1,p("/api/create",e)),handleIterate:e=>p("/api/iterate",e),onDone:t.on,onError:l.on,onStream:d.on}}const i=()=>y("nuxt-session",()=>({})),A=()=>{const t=i();return{loggedIn:u(()=>!!t.value.user),user:u(()=>t.value.user||null),session:t,fetch:b,clear:C}};async function b(){i().value=await T()("/api/_auth/session",{headers:{Accept:"text/json"}}).catch(()=>({}))}async function C(){await $fetch("/api/_auth/session",{method:"DELETE"}),i().value={}}export{I as a,A as b,_ as u};
