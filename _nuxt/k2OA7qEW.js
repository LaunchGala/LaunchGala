import{_ as U,r as v,p as C,x as M,o as p,c as m,a as l,F as N,l as B,b as L,w as A,j as S,L as h}from"./DC9Rc9iq.js";import{_ as $}from"./BDoLV9B3.js";import{u as E}from"./BIqn4ldw.js";const O=["multiple"],R={class:"preview-container"},j=["src"],P={__name:"ImageUploader",props:{allowMultiple:{type:Boolean,default:!0},imageNames:{type:Array,default:()=>[]}},emits:["update:images"],setup(d,{emit:_}){const i=E(),c=_,n=d,u=v(null),r=v([]),f=async()=>{var e;if(((e=n.imageNames)==null?void 0:e.length)>0){const t=await Promise.all(n.imageNames.map(async a=>{const{data:o,error:s}=await i.storage.from("images").createSignedUrl(a,60);return s?(console.error("Error fetching image URL:",s),null):{id:a,url:o.signedUrl}}));r.value=t.filter(a=>a!==null),c("update:images",r.value.map(a=>a.id))}},w=e=>{e.preventDefault(),e.stopPropagation()},y=async e=>{const t=e.dataTransfer.files;await g(t)},g=async e=>{if(e){const t=Array.from(e);if(!n.allowMultiple&&t.length>1){alert("Only one image can be uploaded.");return}n.allowMultiple||(r.value=[]);for(const a of t)await k(a);c("update:images",r.value.map(a=>a.id))}},x=async e=>{const t=e.target.files;await g(t)},k=async e=>{const t=`${Date.now()}_${e.name}`,a=URL.createObjectURL(e);try{const{data:o,error:s}=await i.storage.from("images").upload(t,e);if(s){console.error("Upload error:",s),alert("Failed to upload image.");return}r.value.push({id:o.path,url:a})}catch(o){console.error("Unexpected error:",o)}},D=()=>{u.value&&u.value.click()},b=async(e,t)=>{confirm("Are you sure you want to delete this file?")&&(await F(e,t),c("update:images",r.value.map(a=>a.id)))},F=async(e,t)=>{try{const{error:a}=await i.storage.from("images").remove([e]);if(a){console.error("Deletion error:",a);return}r.value.splice(t,1)}catch(a){console.error("Unexpected error:",a)}};C(()=>{f()});function I(e,t){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}return M(()=>n.imageNames,(e,t)=>{I(e,t)||f()}),(e,t)=>(p(),m("div",{class:"image-uploader",onDragover:h(w,["prevent"]),onDrop:h(y,["prevent"]),onClick:D},[l("input",{type:"file",multiple:d.allowMultiple,accept:"image/*",ref_key:"fileInput",ref:u,onChange:x,class:"file-input"},null,40,O),t[1]||(t[1]=l("div",{class:"drop-message"},[l("p",null,"Drag & Drop Images Here or Click to Select")],-1)),l("div",R,[(p(!0),m(N,null,B(r.value,(a,o)=>(p(),m("div",{key:o,class:"image-wrapper"},[l("img",{src:a.url,class:"preview-image"},null,8,j),L(S($),{onClick:s=>b(a.id,o),class:"remove-button text-lg text-orange-500 hover:border-orange-500 hover:bg-orange-100 font-extrabold ml-2"},{default:A(()=>t[0]||(t[0]=[l("div",{class:"flex items-center"},"X",-1)])),_:2},1032,["onClick"])]))),128))])],32))}},T=U(P,[["__scopeId","data-v-40616d43"]]);export{T as _};
