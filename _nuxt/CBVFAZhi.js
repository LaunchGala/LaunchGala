const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CinEOjz5.js","./D0hPKPsa.js","./entry.x_rTFvki.css"])))=>i.map(i=>d[i]);
import{e as me,o as d,m as v,w as o,b as a,I as se,d as g,t as h,f as Re,g as D,h as je,r as C,x as Be,p as Oe,u as Le,J as Ge,c as U,a as i,j as t,F as G,l as Ne,n as le,k as E,L as ie,q as re,K as T,B as ze,C as qe,de as He,y as de,cQ as Ke}from"./D0hPKPsa.js";import{_ as Je}from"./Bbwf1FS2.js";import{_ as Qe}from"./B146-RAi.js";import{a as We,_ as Xe}from"./0A0oTV4N.js";import{_ as Ye}from"./OMFAdh4D.js";import{_ as Ze,a as et,b as tt}from"./VtAtmFVs.js";import{_ as nt}from"./BRcFwtYB.js";import{a as at,c as ot,d as st,b as lt,_ as it}from"./C762Is21.js";import{k as rt,j as dt,g as ut,i as ct,h as mt,f as ft,_ as pt,A as _t,M as vt,G as gt,T as ht,I as yt,C as wt,b as kt,a as xt,e as Ct,d as bt,c as $t}from"./4XJAwdUH.js";import{_ as Dt}from"./xiru90oy.js";import{u as Ut}from"./Tgvccnlv.js";import{b as Tt,u as At}from"./BpA5sTOg.js";import{f as ue}from"./DrI_N8as.js";import{u as Mt}from"./6bm_RRcn.js";import{u as St}from"./BaDBuZE1.js";import{t as ce,b as It}from"./DtpXwPzu.js";import{a as Vt,S as Et,C as Ft}from"./CeusO0Ne.js";import{T as Pt}from"./mje1Ox_j.js";import"./Covj5mT0.js";import"./B40IJLOr.js";import"./DvDH6DOc.js";import"./CretQxXr.js";function Rt(c){return r=>{const w=(c?Math[c]:Math.trunc)(r);return w===0?0:w}}function jt(c,r){return+ce(c)-+ce(r)}function Bt(c,r,y){const w=jt(c,r)/It;return Rt(y==null?void 0:y.roundingMethod)(w)}const Ot=me({__name:"DialogDelete",props:{title:{},description:{}},setup(c){return(r,y)=>{const w=rt,f=dt,F=ut,u=ct,A=mt,O=ft,k=pt;return d(),v(k,null,{default:o(()=>[a(w,{"as-child":""},{default:o(()=>[se(r.$slots,"default")]),_:3}),a(O,null,{default:o(()=>[a(u,null,{default:o(()=>[a(f,null,{default:o(()=>[g(h(r.title),1)]),_:1}),a(F,null,{default:o(()=>[g(h(r.description),1)]),_:1})]),_:1}),a(A,null,{default:o(()=>[se(r.$slots,"footer")]),_:3})]),_:3})]),_:3})}}}),Lt=He(()=>Ke(()=>import("./CinEOjz5.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(c=>c.default||c).then(c=>$t(c))),Gt={class:"pb-2 md:pb-8"},Nt={class:"flex flex-col md:flex-row w-full"},zt={class:"flex-shrink-0 md:mt-4 md:mr-4 flex flex-row md:flex-col items-center gap-3"},qt={class:"flex gap-2 items-center"},Ht={class:"flex flex-row-reverse md:flex-col-reverse gap-3 overflow-auto p-1"},Kt=["src"],Jt=["src"],Qt={class:"text-sm p-0.5"},Wt={class:"flex-1 mt-2 md:mt-0 w-full"},Xt={class:"flex justify-between"},Yt={class:"flex items-center gap-2"},Zt={class:"text-sm max-w-[9rem] md:max-w-[32rem] text-ellipsis whitespace-nowrap overflow-hidden"},en={class:"flex items-center gap-2"},tn={class:"hidden md:inline"},nn={class:"hidden md:inline"},an=["src"],on={key:0,class:"relative flex items-center justify-center w-full gap-2 mt-3 md:mt-16"},Tn=me({__name:"[slug]",async setup(c){var Q;let r,y;const w=Re(),f=D(()=>w.params.slug.toString()),{toast:F}=St(),{data:u,refresh:A}=([r,y]=je(()=>Ut(`/api/component/${f.value}`,"$FACksf65hK")),r=await r,y(),r),{user:O}=Tt(),k=D(()=>{var n,e;return(e=(n=u.value)==null?void 0:n.at(-1))==null?void 0:e.user}),P=D(()=>{var n,e;return((n=k.value)==null?void 0:n.id)===((e=O.value)==null?void 0:e.id)}),s=C(),L=C();Be(u,n=>{const e=n==null?void 0:n[0];s.value=e,R({code:(e==null?void 0:e.code)??"",error:e==null?void 0:e.error})},{immediate:!0});const b=C(""),{loading:M,contentCode:fe,onDone:pe,onStream:_e,onError:ve,isNewPrompt:ge,handleInit:he,handleIterate:N,handleCreate:z}=At(),x=D(()=>{var n;return((n=s.value)==null?void 0:n.code)??fe.value??""}),ye=D(()=>{var n,e;return(n=s.value)!=null&&n.completed||M.value?!1:(e=s.value)!=null&&e.error?!0:Bt(new Date,new Date(s.value.createdAt))>5});function R(n){var p;const e=new MessageChannel;L.value&&((p=L.value.contentWindow)==null||p.postMessage({from:"vue0",data:n},"*",[e.port2]))}function we(n){s.value=n,R({code:n.code,error:n.error})}function ke(){var e;if(!s.value)return;const n={id:s.value.id,prompt:s.value.description};s.value===((e=u.value)==null?void 0:e.at(-1))?z(n):N(n)}async function xe(){var p,m;if(!b.value)return;T("iterate-generation",{slug:f.value});const n=(p=s.value)==null?void 0:p.id,e=await he(b.value,(m=s.value)==null?void 0:m.slug,n);u.value=[e,...u.value??[]],N({id:e.id,prompt:e.description})}_e(n=>R({code:n})),ve(n=>{A(),F({title:"Error",description:n,variant:"destructive"}),R({code:"",error:n})}),pe(()=>{A(),b.value="",F({title:"Completed",description:"Latest generation is completed!"})}),Oe(()=>{var n;ge.value&&((n=u.value)==null?void 0:n.length)===1&&z({id:u.value[0].id,prompt:u.value[0].description})});const j=C(!1),S=C(!1),{copy:Ce,copied:q}=ue(),{copy:be}=ue();function $e(){be(location.href),T("share-generation",{slug:f.value})}const H=C(!1);async function De(){var n;H.value=!0,T("fork-generation");try{const e=await $fetch("/api/component/fork",{method:"POST",body:{id:(n=s.value)==null?void 0:n.id,slug:f.value}});e.id&&de(`/t/${e.slug}`)}catch(e){console.log(e)}finally{H.value=!1}}const $=C(!1);async function K(n=!1){var p,m;$.value=!0;const e=n?{slug:f.value,id:(p=s.value)==null?void 0:p.id}:{id:(m=s.value)==null?void 0:m.id};T("delete-generation");try{await $fetch("/api/component/delete",{method:"POST",body:e})&&(n?await de("/"):await A())}catch(I){console.log(I)}finally{$.value=!1,j.value=!1}}const J=D(()=>{var n,e;return Mt(((e=(n=u.value)==null?void 0:n.at(-1))==null?void 0:e.description)??"")});return Le({title(){return J.value}}),defineOgImageComponent("Generated",{title:J.value,avatarUrl:(Q=k.value)==null?void 0:Q.avatarUrl,imageUrl:`${Ge().public.siteUrl}/api/image/${f.value}?slug=true`}),(n,e)=>{var te,ne,ae;const p=Je,m=Qe,I=We,W=Ye,X=Xe,Ue=Ze,Te=et,Ae=tt,Me=nt,Se=at,B=ot,Ie=st,Y=Ct,Z=bt,ee=Ot,Ve=lt,Ee=it,Fe=Lt,Pe=Dt;return d(),U("div",Gt,[i("div",Nt,[i("div",zt,[i("div",qt,[a(t(Vt),{class:"w-4 h-4 text-gray-400"}),e[9]||(e[9]=i("span",{class:"text-gray-400 font-medium text-sm hidden md:inline-flex"},"Versions",-1))]),i("div",Ht,[(d(!0),U(G,null,Ne(t(u),(l,_)=>(d(),U("div",{key:l.id},[a(X,{"delay-duration":500},{default:o(()=>[a(I,{"as-child":""},{default:o(()=>{var V;return[a(m,{class:le(["justify-start h-auto min-w-[6rem] min-h-6 p-1 overflow-hidden text-left text-gray-400 rounded-lg outline-1 hover:text-primary relative",{"outline outline-primary !text-primary":((V=t(s))==null?void 0:V.id)===l.id}]),variant:"secondary",onClick:oe=>we(l)},{default:o(()=>[a(p,{variant:"outline",class:"bg-white absolute bottom-2 left-2"},{default:o(()=>[g(" v"+h(t(u).length-1-_),1)]),_:2},1024),i("img",{src:`/api/image/${l.id}`,class:"aspect-video object-cover w-32 h-auto"},null,8,Kt)]),_:2},1032,["class","onClick"])]}),_:2},1024),a(W,{align:"start",side:"right",class:"max-w-64 flex flex-col gap-2 p-1.5"},{default:o(()=>[i("img",{src:`/api/image/${l.id}`,class:"aspect-video object-cover w-auto h-auto rounded"},null,8,Jt),i("span",Qt,h(l.description),1)]),_:2},1024)]),_:2},1024)]))),128))])]),i("div",Wt,[i("div",Xt,[i("div",Yt,[t(k)?(d(),v(Me,{key:0,class:"inline-flex",to:`/${t(k).name}`},{default:o(()=>[a(Ae,{class:"w-9 h-9"},{default:o(()=>[a(Ue,{src:t(k).avatarUrl??""},null,8,["src"]),a(Te,null,{default:o(()=>{var l;return[g(h((l=t(k).name)==null?void 0:l.slice(0,1)),1)]}),_:1})]),_:1})]),_:1},8,["to"])):E("",!0),i("div",Zt,h((te=t(s))==null?void 0:te.description),1)]),i("div",en,[(ne=t(s))!=null&&ne.error?(d(),v(X,{key:0},{default:o(()=>[a(I,{class:"text-destructive mr-2"},{default:o(()=>[a(t(_t),{class:"p-0.5"})]),_:1}),a(W,{class:"bg-destructive",side:"bottom"},{default:o(()=>{var l;return[g(" Error "+h((l=t(s))==null?void 0:l.error),1)]}),_:1})]),_:1})):E("",!0),a(Ee,{open:t(j),"onUpdate:open":e[4]||(e[4]=l=>re(j)?j.value=l:null)},{default:o(()=>[a(Se,{"as-child":""},{default:o(()=>[a(m,{size:"icon",variant:"outline"},{default:o(()=>[a(t(vt),{class:"p-1"})]),_:1})]),_:1}),a(Ve,{align:"end"},{default:o(()=>{var l,_,V;return[a(B,{disabled:!t(x),onClick:De},{default:o(()=>[a(t(gt),{class:"py-1 mr-1"}),e[10]||(e[10]=i("span",null,"Fork",-1))]),_:1},8,["disabled"]),a(B,{onClick:$e},{default:o(()=>[a(t(Et),{class:"py-1 mr-1"}),e[11]||(e[11]=i("span",null,"Share",-1))]),_:1}),t(P)?(d(),U(G,{key:0},[a(Ie),((l=t(s))==null?void 0:l.id)!==((V=(_=t(u))==null?void 0:_.at(-1))==null?void 0:V.id)?(d(),v(ee,{key:0,title:"Are you sure you want to delete this version?",description:"This will delete the current selected version. This action cannot be undone."},{footer:o(()=>[a(Y,{disabled:t($)},{default:o(()=>e[13]||(e[13]=[g(" Cancel ")])),_:1},8,["disabled"]),a(Z,{"as-child":""},{default:o(()=>[a(m,{variants:"'destructive'",loading:t($),onClick:e[1]||(e[1]=oe=>K())},{default:o(()=>e[14]||(e[14]=[g(" Delete Version ")])),_:1},8,["loading"])]),_:1})]),default:o(()=>[a(B,{class:"!text-destructive",onSelect:e[0]||(e[0]=ie(()=>{},["prevent"]))},{default:o(()=>[a(t(ht),{class:"py-1 mr-1"}),e[12]||(e[12]=i("span",null,"Delete Version",-1))]),_:1})]),_:1})):E("",!0),a(ee,{title:"Are you sure you want to delete this generation?",description:"This will delete the generation and all results. This action cannot be undone."},{footer:o(()=>[a(Y,{disabled:t($)},{default:o(()=>e[16]||(e[16]=[g(" Cancel ")])),_:1},8,["disabled"]),a(Z,{"as-child":""},{default:o(()=>[a(m,{variants:"'destructive'",loading:t($),onClick:e[3]||(e[3]=oe=>K(!0))},{default:o(()=>e[17]||(e[17]=[g(" Delete Generation ")])),_:1},8,["loading"])]),_:1})]),default:o(()=>[a(B,{class:"!text-destructive",onSelect:e[2]||(e[2]=ie(()=>{},["prevent"]))},{default:o(()=>[a(t(Pt),{class:"py-1 mr-1"}),e[15]||(e[15]=i("span",null,"Delete Generation",-1))]),_:1})]),_:1})],64)):E("",!0)]}),_:1})]),_:1},8,["open"]),t(ye)&&t(P)?(d(),v(m,{key:1,class:"px-1.5 md:px-4",disabled:t(M)&&!t(x),variant:"outline",onClick:e[5]||(e[5]=l=>{var _;ke(),("umTrackEvent"in n?n.umTrackEvent:t(T))("regenerate-code",{id:(_=t(s))==null?void 0:_.id})})},{default:o(()=>[a(t(yt),{class:"py-1 md:mr-1 md:-ml-1"}),e[18]||(e[18]=i("span",{class:"hidden md:inline"},"Regenerate",-1))]),_:1},8,["disabled"])):(d(),U(G,{key:2},[a(m,{class:"px-1.5 md:px-4",loading:t(M)&&!t(x),disabled:!t(x),variant:"outline",onClick:e[6]||(e[6]=l=>{var _;t(Ce)(((_=t(s))==null?void 0:_.code)??""),("umTrackEvent"in n?n.umTrackEvent:t(T))("copy-code",{slug:t(f)})})},{default:o(()=>[t(q)?(d(),v(t(wt),{key:0,class:"py-1 md:mr-1 md:-ml-1"})):(d(),v(t(Ft),{key:1,class:"py-1 md:mr-1 md:-ml-1"})),i("span",tn,h(t(q)?"Copied":"Copy"),1)]),_:1},8,["loading","disabled"]),a(m,{class:"px-1.5 md:px-4",loading:t(M)&&!t(x),disabled:!t(x),onClick:e[7]||(e[7]=l=>S.value=!t(S))},{default:o(()=>[t(S)?(d(),v(t(kt),{key:0,class:"py-1 md:mr-1 md:-ml-1"})):(d(),v(t(xt),{key:1,class:"py-1 md:mr-1 md:-ml-1"})),i("span",nn,h(t(S)?"Preview":"Code"),1)]),_:1},8,["loading","disabled"])],64))])]),i("div",{class:le(["relative z-0 flex w-full mt-3 md:mt-4 overflow-hidden border rounded-xl",[t(P)?"h-[calc(100vh-14rem)]":"h-[calc(100vh-10rem)]"]])},[ze(a(Fe,{"sfc-string":t(x)},null,8,["sfc-string"]),[[qe,t(S)]]),i("iframe",{ref_key:"iframeRef",ref:L,src:`/p/${t(f)}`,class:"w-full h-full"},null,8,an)],2)])]),t(P)&&!((ae=t(s))!=null&&ae.error)?(d(),U("div",on,[a(Pe,{modelValue:t(b),"onUpdate:modelValue":e[8]||(e[8]=l=>re(b)?b.value=l:null),loading:t(M),class:"md:absolute bottom-0 w-full md:w-fit md:-translate-x-1/2 left-1/2",placeholder:"Make the padding larger",onSubmit:xe},null,8,["modelValue","loading"])])):E("",!0)])}}});export{Tn as default};
